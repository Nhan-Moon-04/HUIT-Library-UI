<!-- Trang Chi Tiết Phiếu Đặt Phòng -->
@if (!loading() && bookingDetail()) {
<div class="chi-tiet-phieu">
    <!-- Đầu trang -->
    <div class="dau-trang">
        <div class="noi-dung-dau">
            <div class="duong-dan">
                <button class="nut-quay-lai" (click)="router.navigate(['/bookings'])">
                    <i class="material-icons">arrow_back</i>
                    Danh sách phiếu đặt
                </button>
                <span class="phan-cach">/</span>
                <span class="trang-hien-tai">Chi tiết phiếu #{{ bookingDetail()!.maDangKy }}</span>
            </div>
        </div>
    </div>

    <!-- Nội dung chính -->
    <div class="noi-dung-chinh">
        <div class="the-chi-tiet">
            <!-- Đầu trạng thái -->
            <div class="dau-trang-thai" [ngClass]="getStatusClass(bookingDetail()!.maTrangThai)">
                <div class="thong-tin-trang-thai">
                    <div class="bieu-tuong-trang-thai">
                        <i class="material-icons">{{ getStatusIcon(bookingDetail()!.maTrangThai) }}</i>
                    </div>
                    <div class="chu-trang-thai">
                        <h1>{{ bookingDetail()!.tenTrangThai }}</h1>
                        <p>Phiếu đặt phòng #{{ bookingDetail()!.maDangKy }}</p>
                    </div>
                </div>
                <div class="ngay-tao">
                    <span>Ngày tạo: {{ formatDate(bookingDetail()!.ngayMuon) }}</span>
                </div>
            </div>

            <!-- Thông tin phòng -->
            <div class="muc-chi-tiet">
                <h2 class="tieu-de-muc">
                    <i class="material-icons">meeting_room</i>
                    Thông tin phòng
                </h2>
                <div class="luoi-thong-tin">
                    <div class="muc-thong-tin">
                        <label>Tên phòng</label>
                        <span class="gia-tri">{{ bookingDetail()!.tenPhong }}</span>
                    </div>
                    <div class="muc-thong-tin">
                        <label>Loại phòng</label>
                        <span class="gia-tri">{{ bookingDetail()!.tenLoaiPhong }}</span>
                    </div>
                </div>
            </div>

            <!-- Thời gian sử dụng -->
            <div class="muc-chi-tiet">
                <h2 class="tieu-de-muc">
                    <i class="material-icons">schedule</i>
                    Thời gian sử dụng
                </h2>
                <div class="thong-tin-thoi-gian">
                    <div class="muc-thoi-gian">
                        <div class="bieu-tuong-thoi-gian bat-dau">
                            <i class="material-icons">play_arrow</i>
                        </div>
                        <div class="chi-tiet-thoi-gian">
                            <label>Bắt đầu</label>
                            <span class="gia-tri-thoi-gian">{{ formatDateTime(bookingDetail()!.thoiGianBatDau) }}</span>
                        </div>
                    </div>
                    <div class="phan-chia-thoi-gian">
                        <i class="material-icons">arrow_forward</i>
                    </div>
                    <div class="muc-thoi-gian">
                        <div class="bieu-tuong-thoi-gian ket-thuc">
                            <i class="material-icons">stop</i>
                        </div>
                        <div class="chi-tiet-thoi-gian">
                            <label>Kết thúc</label>
                            <span class="gia-tri-thoi-gian">{{ formatDateTime(bookingDetail()!.thoiGianKetThuc)
                                }}</span>
                        </div>
                    </div>
                </div>

                <!-- Thời gian thực tế -->
                @if (bookingDetail()!.gioBatDauThucTe || bookingDetail()!.gioKetThucThucTe) {
                <div class="thoi-gian-thuc-te">
                    <h3>Thời gian thực tế</h3>
                    <div class="thong-tin-thuc-te">
                        @if (bookingDetail()!.gioBatDauThucTe) {
                        <div class="muc-thuc-te">
                            <label>Bắt đầu thực tế</label>
                            <span>{{ formatDateTime(bookingDetail()!.gioBatDauThucTe!) }}</span>
                        </div>
                        }
                        @if (bookingDetail()!.gioKetThucThucTe) {
                        <div class="muc-thuc-te">
                            <label>Kết thúc thực tế</label>
                            <span>{{ formatDateTime(bookingDetail()!.gioKetThucThucTe!) }}</span>
                        </div>
                        }
                    </div>
                </div>
                }
            </div>

            <!-- Chi tiết đặt phòng -->
            <div class="muc-chi-tiet">
                <h2 class="tieu-de-muc">
                    <i class="material-icons">description</i>
                    Chi tiết đặt phòng
                </h2>
                <div class="luoi-thong-tin">
                    @if (bookingDetail()!.lyDo) {
                    <div class="muc-thong-tin">
                        <label>Mục đích</label>
                        <span class="gia-tri">{{ bookingDetail()!.lyDo }}</span>
                    </div>
                    }
                    @if (bookingDetail()!.soLuong) {
                    <div class="muc-thong-tin">
                        <label>Số lượng người</label>
                        <span class="gia-tri">{{ bookingDetail()!.soLuong }} người</span>
                    </div>
                    }
                    @if (bookingDetail()!.ghiChu) {
                    <div class="muc-thong-tin full-width">
                        <label>Ghi chú</label>
                        <span class="gia-tri">{{ bookingDetail()!.ghiChu }}</span>
                    </div>
                    }
                </div>
            </div>

            <!-- Thông tin duyệt -->
            @if (bookingDetail()!.ngayDuyet) {
            <div class="muc-chi-tiet">
                <h2 class="tieu-de-muc">
                    <i class="material-icons">verified</i>
                    Thông tin duyệt
                </h2>
                <div class="luoi-thong-tin">
                    <div class="muc-thong-tin">
                        <label>Ngày duyệt</label>
                        <span class="gia-tri">{{ formatDateTime(bookingDetail()!.ngayDuyet!) }}</span>
                    </div>
                </div>
            </div>
            }

            <!-- Tình trạng phòng -->
            @if (bookingDetail()!.tinhTrangPhong || bookingDetail()!.ghiChuSuDung) {
            <div class="muc-chi-tiet">
                <h2 class="tieu-de-muc">
                    <i class="material-icons">fact_check</i>
                    Tình trạng phòng
                </h2>
                <div class="luoi-thong-tin">
                    @if (bookingDetail()!.tinhTrangPhong) {
                    <div class="muc-thong-tin">
                        <label>Tình trạng</label>
                        <span class="gia-tri">{{ bookingDetail()!.tinhTrangPhong }}</span>
                    </div>
                    }
                    @if (bookingDetail()!.ghiChuSuDung) {
                    <div class="muc-thong-tin full-width">
                        <label>Ghi chú sử dụng</label>
                        <span class="gia-tri">{{ bookingDetail()!.ghiChuSuDung }}</span>
                    </div>
                    }
                </div>
            </div>
            }

            <!-- Biên bản vi phạm -->
            @if (violations().length > 0) {
            <div class="muc-chi-tiet">
                <h2 class="tieu-de-muc violation-header">
                    <i class="material-icons">warning</i>
                    Biên bản vi phạm ({{ violations().length }})
                </h2>
                <div class="violation-list">
                    @for (violation of violations(); track violation.maViPham) {
                    <div class="violation-item" (click)="viewViolationDetail(violation.maViPham)">
                        <div class="violation-icon">
                            <i class="material-icons" [style.color]="getViolationStatusColor(violation.trangThaiXuLy)">
                                {{ getViolationStatusIcon(violation.trangThaiXuLy) }}
                            </i>
                        </div>
                        <div class="violation-content">
                            <h4>{{ violation.tenViPham }}</h4>
                            @if (violation.moTaNgan) {
                            <p class="violation-note">{{ violation.moTaNgan }}</p>
                            }
                            <div class="violation-meta">
                                <span class="violation-date">{{ formatViolationDate(violation.ngayLap) }}</span>
                                <span class="violation-status"
                                    [style.color]="getViolationStatusColor(violation.trangThaiXuLy)">
                                    {{ violation.trangThaiXuLy }}
                                </span>
                            </div>
                        </div>
                        <div class="violation-action">
                            <i class="material-icons">chevron_right</i>
                        </div>
                    </div>
                    }
                </div>
                @if (loadingViolations()) {
                <div class="violation-loading">
                    <div class="vong-quay-nho"></div>
                    <span>Đang tải biên bản...</span>
                </div>
                }
            </div>
            }

            <!-- Các hành động -->
            @if (canShowActions()) {
            <div class="cac-hanh-dong">
                <button class="nut-hanh-dong ke-ngoai" (click)="router.navigate(['/bookings'])">
                    <i class="material-icons">list</i>
                    Về danh sách
                </button>
                @if (canExtend()) {
                <button class="nut-hanh-dong chinh">
                    <i class="material-icons">access_time</i>
                    Gia hạn
                </button>
                }
                @if (canCancel()) {
                <button class="nut-hanh-dong nguy-hiem">
                    <i class="material-icons">cancel</i>
                    Hủy đặt phòng
                </button>
                }
            </div>
            }
        </div>
    </div>
</div>
}

<!-- Trạng thái đang tải -->
@if (loading()) {
<div class="trang-thai-tai">
    <div class="noi-dung-tai">
        <div class="vong-quay"></div>
        <p>Đang tải chi tiết phiếu đặt phòng...</p>
    </div>
</div>
}

<!-- Trạng thái lỗi -->
@if (error()) {
<div class="trang-thai-loi">
    <div class="noi-dung-loi">
        <i class="material-icons">error</i>
        <h2>Không thể tải chi tiết</h2>
        <p>{{ error() }}</p>
        <div class="hanh-dong-loi">
            <button class="nut-hanh-dong ke-ngoai" (click)="loadBookingDetail()">
                <i class="material-icons">refresh</i>
                Thử lại
            </button>
            <button class="nut-hanh-dong chinh" (click)="router.navigate(['/bookings'])">
                <i class="material-icons">list</i>
                Về danh sách
            </button>
        </div>
    </div>
</div>
}