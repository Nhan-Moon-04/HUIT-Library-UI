<div class="history-page ">
    <!-- Page Header -->
    <div class="page-header">
        <div class="header-container">
            <div class="header-content">
                <div class="header-title">
                    <h1>
                        <i class="fas fa-history"></i>
                        Lịch sử mượn phòng
                    </h1>
                    <p>Quản lý và theo dõi lịch sử đặt phòng của bạn</p>
                </div>
                <div class="header-actions">
                    <button class="btn-new-booking" (click)="navigateToBooking()" type="button">
                        <i class="fas fa-plus"></i>
                        Đặt phòng mới
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div class="page-container">
        <!-- Search & Controls Section -->
        <div class="page-controls">
            <!-- Search Section -->
            <div class="search-section">
                <div class="search-controls">
                    <div class="search-input-group">
                        <i class="fas fa-search search-icon"></i>
                        <input type="text" class="search-input" placeholder="Tìm kiếm theo tên phòng, lý do, ghi chú..."
                            [value]="searchTerm()" (input)="updateSearchTerm($any($event.target).value)"
                            (keypress)="onSearchKeyPress($event)" />
                        @if (searchTerm().length > 0) {
                        <button type="button" class="clear-search-btn" (click)="resetSearch()" title="Xóa tìm kiếm">
                            <i class="fas fa-times"></i>
                        </button>
                        }
                    </div>
                    <button type="button" class="search-btn" (click)="onSearch()" [disabled]="loading()">
                        <i class="fas fa-search"></i>
                        Tìm kiếm
                    </button>
                    @if (isSearchMode()) {
                    <button type="button" class="reset-btn" (click)="resetSearch()">
                        <i class="fas fa-undo"></i>
                        Hiện tất cả
                    </button>
                    }
                </div>
            </div>

            <!-- Page Size Control -->
            <label class="page-size-control">
                <span>Hiển thị</span>
                <select [value]="pageSize()" (change)="onPageSizeChange($any($event.target).value)"
                    class="page-size-select">
                    <option [value]="10">10</option>
                    <option [value]="25">25</option>
                    <option [value]="50">50</option>
                </select>
                <span>bản ghi</span>
            </label>
        </div>
        <!-- Messages Section -->
        <div class="messages-section">
            @if (loading()) {
            <div class="alert alert-loading">
                <i class="fas fa-spinner fa-spin"></i>
                Đang tải lịch sử mượn phòng...
            </div>
            }

            @if (error()) {
            <div class="alert alert-error">
                <i class="fas fa-exclamation-triangle"></i>
                {{ error() }}
            </div>
            }
 


            @if (!loading() && message()) {
            <div class="alert alert-info">
                <i class="fas fa-info-circle"></i>
                {{ message() }}
            </div>
            }
        </div>

        <!-- History Section -->
        @if (!loading() && bookings().length > 0) {
        <div class="history-section">
            <div class="section-header">
                <div class="section-title">
                    <i class="fas fa-history"></i>
                    <h2>
                        @if (isSearchMode()) {
                        Kết quả tìm kiếm
                        } @else {
                        Lịch sử mượn phòng
                        }
                    </h2>
                    <span class="count-badge">{{ bookings().length }}</span>
                </div>
                @if (isSearchMode()) {
                <span class="search-badge">
                    <i class="fas fa-search"></i>
                    "{{ searchTerm() }}"
                </span>
                }
            </div>

            <!-- History List -->
            <div class="history-list">
                @for (booking of bookings(); track booking.maDangKy) {
                <div class="history-item" [ngClass]="'status-' + booking.maTrangThai"
                    (click)="viewBookingDetail(booking.maDangKy)">

                    <div class="item-status">
                        <div class="status-icon" [ngClass]="getHistoryStatusClass(booking.maTrangThai)">
                            <i class="fas" [ngClass]="getHistoryStatusIcon(booking.maTrangThai)"></i>
                        </div>
                    </div>

                    <div class="item-content">
                        <div class="item-header">
                            <h3 class="room-name">
                                <i class="fas fa-door-open"></i>
                                {{ booking.tenPhong }}
                            </h3>
                            <div class="booking-meta">
                                <span class="booking-id">#{{ booking.maDangKy }}</span>
                                <span class="room-type">{{ booking.tenLoaiPhong }}</span>
                            </div>
                        </div>

                        <div class="item-details">
                            <div class="detail-row">
                                <i class="fas fa-clock"></i>
                                <span>{{ formatDateTime(booking.thoiGianBatDau) }} - {{
                                    formatDateTime(booking.thoiGianKetThuc) }}</span>
                            </div>
                            @if (booking.soLuong) {
                            <div class="detail-row">
                                <i class="fas fa-users"></i>
                                <span>{{ booking.soLuong }} người</span>
                            </div>
                            }
                            @if (booking.lyDo) {
                            <div class="detail-row">
                                <i class="fas fa-file-alt"></i>
                                <span>{{ booking.lyDo }}</span>
                            </div>
                            }
                            @if (booking.ghiChu || booking.ghiChuSuDung) {
                            <div class="detail-row note-row">
                                <i class="fas fa-comment"></i>
                                <span>{{ booking.ghiChu || booking.ghiChuSuDung }}</span>
                            </div>
                            }
                        </div>

                        <div class="item-meta">
                            <span class="status-text">{{ booking.tenTrangThai }}</span>
                            <span class="date-text">{{ formatDateTime(booking.ngayMuon) }}</span>
                        </div>
                    </div>

                    <div class="item-actions">
                        <button class="detail-btn"
                            (click)="viewBookingDetail(booking.maDangKy); $event.stopPropagation()"
                            title="Xem chi tiết">
                            <i class="fas fa-eye"></i>
                            Chi tiết
                        </button>
                    </div>
                </div>
                }
            </div>

            <!-- Pagination Section -->
            <div class="pagination-section">
                <div class="pagination-left">
                    <button class="btn-back-home" (click)="navigateToDashboard()" type="button"
                        title="Quay lại trang chủ">
                        <i class="fas fa-arrow-left"></i>
                        <span>Quay lại</span>
                    </button>
                </div>

                <div class="pagination-center">
                    <button class="btn-pagination" (click)="prev()" [disabled]="pageNumber() <= 1" type="button"
                        aria-label="Trang trước">
                        <i class="fas fa-chevron-left"></i>
                        <span>Trang trước</span>
                    </button>

                    <div class="pagination-info" aria-live="polite">
                        <span class="current-page">{{ pageNumber() }}</span>
                        <span class="separator">/</span>
                        <span class="total-pages">{{ totalPages() }}</span>
                    </div>

                    <button class="btn-pagination" (click)="next()" [disabled]="pageNumber() >= totalPages()"
                        type="button" aria-label="Trang sau">
                        <span>Trang sau</span>
                        <i class="fas fa-chevron-right"></i>
                    </button>
                </div>

                <div class="pagination-right">
                    <div class="section-badge">{{ totalItems() || bookings().length }} bản ghi</div>
                </div>
            </div>
        </div>
        }


        <!-- Empty State -->
        @if (!loading() && bookings().length === 0) {
        <div class="empty-state">
            <div class="empty-icon">
                <i class="fas fa-history"></i>
            </div>
            <h3>Chưa có lịch sử mượn phòng</h3>
            <p>Bạn chưa có bất kỳ bản ghi mượn phòng nào trong hệ thống.<br>
                Hãy đặt phòng để bắt đầu sử dụng dịch vụ của thư viện.</p>
            <button class="btn btn-primary" type="button" onclick="window.location.href='/booking/create'">
                <i class="fas fa-plus"></i>
                Đặt phòng ngay
            </button>
        </div>
        }
    </div>
</div>