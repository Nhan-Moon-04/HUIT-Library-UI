<!-- Modern Violation Detail Page -->
<div class="modern-violation-detail">
    <!-- Header Section -->
    <div class="detail-header">
        <div class="container">
            <div class="header-content">
                <div class="breadcrumb">
                    <button class="back-btn" (click)="goBack()">
                        <i class="fas fa-arrow-left"></i>
                        <span>Quay lại</span>
                    </button>
                    <i class="fas fa-chevron-right separator"></i>
                    <span class="current-page">Chi tiết vi phạm</span>
                </div>

                @if (!loading() && violationDetail()) {
                <div class="header-info">
                    <div class="violation-title">
                        <h1>Biên bản vi phạm #{{ violationDetail()!.maViPham }}</h1>
                        <span class="violation-type">{{ violationDetail()!.tenViPham }}</span>
                    </div>
                    <div class="status-section">
                        <div class="status-badge" [ngClass]="getViolationStatusClass(violationDetail()!.trangThaiXuLy)">
                            <i class="fas" [ngClass]="getViolationStatusIcon(violationDetail()!.trangThaiXuLy)"></i>
                            <span>{{ violationDetail()!.trangThaiXuLy }}</span>
                        </div>
                    </div>
                </div>
                }
            </div>
        </div>
    </div>

    <!-- Main Content -->
    @if (!loading() && violationDetail()) {
    <div class="detail-content">
        <div class="container">
            <div class="content-grid">
                <!-- Violation Information Card -->
                <div class="detail-card main-info">
                    <div class="card-header">
                        <div class="card-title">
                            <i class="fas fa-exclamation-triangle"></i>
                            <h3>Thông tin vi phạm</h3>
                        </div>
                        <div class="card-actions">
                            <button class="action-btn print" (click)="printViolation()" title="In biên bản">
                                <i class="fas fa-print"></i>
                            </button>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="violation-summary">
                            <div class="summary-row primary">
                                <label>Loại vi phạm</label>
                                <span class="value">{{ violationDetail()!.tenViPham }}</span>
                            </div>
                        </div>

                        <div class="description-section">
                            <h4>Mô tả chi tiết</h4>
                            <p class="description-text">{{ violationDetail()!.moTa }}</p>
                        </div>

                        @if (violationDetail()!.ghiChu) {
                        <div class="note-section">
                            <h4>Ghi chú</h4>
                            <p class="note-text">{{ violationDetail()!.ghiChu }}</p>
                        </div>
                        }
                    </div>
                </div>

                <!-- Timeline Information Card -->
                <div class="detail-card timeline-info">
                    <div class="card-header">
                        <div class="card-title">
                            <i class="fas fa-clock"></i>
                            <h3>Thời gian & Người xử lý</h3>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="timeline">
                            <div class="timeline-item">
                                <div class="timeline-icon violation">
                                    <i class="fas fa-exclamation-triangle"></i>
                                </div>
                                <div class="timeline-content">
                                    <h5>Thời gian vi phạm</h5>
                                    <span class="time-value">{{ formatDateTime(violationDetail()!.thoiGianViPham)
                                        }}</span>
                                </div>
                            </div>

                            <div class="timeline-item">
                                <div class="timeline-icon report">
                                    <i class="fas fa-file-alt"></i>
                                </div>
                                <div class="timeline-content">
                                    <h5>Ngày lập biên bản</h5>
                                    <span class="time-value">{{ formatDateTime(violationDetail()!.ngayLap) }}</span>
                                </div>
                            </div>
                        </div>

                        <div class="reporter-section">
                            <div class="reporter-info">
                                <div class="reporter-icon">
                                    <i class="fas fa-user-shield"></i>
                                </div>
                                <div class="reporter-details">
                                    <label>Người lập biên bản</label>
                                    <span class="reporter-name">{{ violationDetail()!.nguoiLapBienBan }}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Location Information Card -->
                <div class="detail-card location-info">
                    <div class="card-header">
                        <div class="card-title">
                            <i class="fas fa-map-marker-alt"></i>
                            <h3>Vị trí vi phạm</h3>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="location-details">
                            <div class="location-item">
                                <div class="location-icon">
                                    <i class="fas fa-door-open"></i>
                                </div>
                                <div class="location-text">
                                    <label>Phòng</label>
                                    <span class="room-name">{{ violationDetail()!.tenPhong }}</span>
                                </div>
                            </div>

                            @if (violationDetail()!.maDangKy) {
                            <div class="booking-link">
                                <button class="link-btn" (click)="goToBookingDetail()">
                                    <i class="fas fa-external-link-alt"></i>
                                    <span>Xem chi tiết đặt phòng #{{ violationDetail()!.maDangKy }}</span>
                                </button>
                            </div>
                            }
                        </div>
                    </div>
                </div>
            </div>

            <!-- Status Process Card (Full Width) -->
            <div class="detail-card status-process">
                <div class="card-header">
                    <div class="card-title">
                        <i class="fas fa-tasks"></i>
                        <h3>Trạng thái xử lý</h3>
                    </div>
                </div>
                <div class="card-body">
                    <div class="status-flow">
                        <div class="flow-step" [class.completed]="violationDetail()!.trangThaiXuLy !== 'Chưa xử lý'"
                            [class.current]="violationDetail()!.trangThaiXuLy === 'Chưa xử lý'">
                            <div class="step-icon">
                                <i class="fas fa-exclamation-triangle"></i>
                            </div>
                            <div class="step-info">
                                <h5>Chưa xử lý</h5>
                                <span>Vi phạm vừa được ghi nhận</span>
                            </div>
                        </div>

                        <div class="flow-connector" [class.active]="violationDetail()!.trangThaiXuLy !== 'Chưa xử lý'">
                        </div>

                        <div class="flow-step" [class.completed]="violationDetail()!.trangThaiXuLy === 'Đã xử lý'"
                            [class.current]="violationDetail()!.trangThaiXuLy === 'Đang xử lý'">
                            <div class="step-icon">
                                <i class="fas fa-clock"></i>
                            </div>
                            <div class="step-info">
                                <h5>Đang xử lý</h5>
                                <span>Đang trong quá trình xem xét</span>
                            </div>
                        </div>

                        <div class="flow-connector" [class.active]="violationDetail()!.trangThaiXuLy === 'Đã xử lý'">
                        </div>

                        <div class="flow-step" [class.completed]="violationDetail()!.trangThaiXuLy === 'Đã xử lý'"
                            [class.current]="violationDetail()!.trangThaiXuLy === 'Đã xử lý'">
                            <div class="step-icon">
                                <i class="fas fa-check-circle"></i>
                            </div>
                            <div class="step-info">
                                <h5>Đã xử lý</h5>
                                <span>Vi phạm đã được xử lý hoàn tất</span>
                            </div>
                        </div>
                    </div>

                    <div class="current-status">
                        <div class="status-indicator"
                            [style.background-color]="getViolationStatusColor(violationDetail()!.trangThaiXuLy)"></div>
                        <span class="status-text">Trạng thái hiện tại: <strong>{{ violationDetail()!.trangThaiXuLy
                                }}</strong></span>
                    </div>
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="action-section">
                <div class="action-buttons">
                    <button class="action-btn secondary" (click)="goBack()">
                        <i class="fas fa-arrow-left"></i>
                        <span>Quay lại</span>
                    </button>

                    @if (violationDetail()!.maDangKy) {
                    <button class="action-btn primary" (click)="goToBookingDetail()">
                        <i class="fas fa-calendar-alt"></i>
                        <span>Xem đặt phòng</span>
                    </button>
                    }

                    <button class="action-btn info" (click)="printViolation()">
                        <i class="fas fa-print"></i>
                        <span>In biên bản</span>
                    </button>
                </div>
            </div>
        </div>
    </div>
    }

    <!-- Loading State -->
    @if (loading()) {
    <div class="loading-state">
        <div class="container">
            <div class="loading-content">
                <div class="spinner large"></div>
                <h3>Đang tải chi tiết vi phạm...</h3>
                <p>Vui lòng đợi trong giây lát</p>
            </div>
        </div>
    </div>
    }

    <!-- Error State -->
    @if (error()) {
    <div class="error-state">
        <div class="container">
            <div class="error-content">
                <div class="error-icon">
                    <i class="fas fa-exclamation-triangle"></i>
                </div>
                <h3>Không thể tải chi tiết vi phạm</h3>
                <p>{{ error() }}</p>
                <div class="error-actions">
                    <button class="action-btn secondary" (click)="loadViolationDetail()">
                        <i class="fas fa-refresh"></i>
                        <span>Thử lại</span>
                    </button>
                    <button class="action-btn primary" (click)="goBack()">
                        <i class="fas fa-arrow-left"></i>
                        <span>Quay lại</span>
                    </button>
                </div>
            </div>
        </div>
    </div>
    }