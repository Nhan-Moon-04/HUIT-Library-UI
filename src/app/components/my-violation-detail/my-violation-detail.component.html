<!-- My Violation Detail Page -->
<div class="violation-detail-page">
    <!-- Header -->
    <div class="page-header">
        <div class="container">
            <div class="header-content">
                <div class="breadcrumb">
                    <button class="back-btn" (click)="goBack()">
                        <i class="fas fa-arrow-left"></i>
                        <span>Danh sách vi phạm</span>
                    </button>
                    <i class="fas fa-chevron-right separator"></i>
                    <span class="current-page">Chi tiết vi phạm</span>
                </div>

                @if (!loading() && violationDetail()) {
                <div class="page-title">
                    <div class="title-content">
                        <h1>
                            <i class="fas fa-exclamation-triangle"></i>
                            {{ violationDetail()!.tenViPham }}
                        </h1>
                        <span class="violation-id">#{{ violationDetail()!.maViPham }}</span>
                    </div>
                    <div class="status-section">
                        <span class="status-badge" [ngClass]="getStatusClass(violationDetail()!.trangThaiXuLy)"
                            [style.background-color]="getStatusColor(violationDetail()!.trangThaiXuLy)">
                            <i class="fas" [ngClass]="getStatusIcon(violationDetail()!.trangThaiXuLy)"></i>
                            {{ violationDetail()!.trangThaiXuLy }}
                        </span>
                    </div>
                </div>
                }

                <div class="page-actions">
                    <button class="action-btn secondary" (click)="refresh()" [disabled]="loading()">
                        <i class="fas fa-refresh" [class.fa-spin]="loading()"></i>
                        Làm mới
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    @if (!loading() && !error() && violationDetail()) {
    <div class="page-content">
        <div class="container">
            <div class="content-grid">

                <!-- Violation Information Card -->
                <div class="detail-card">
                    <div class="card-header">
                        <div class="card-title">
                            <i class="fas fa-file-alt"></i>
                            <h3>Thông tin vi phạm</h3>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="info-grid">
                            <div class="info-item full-width">
                                <label>Tên vi phạm</label>
                                <span class="value primary">{{ violationDetail()!.tenViPham }}</span>
                            </div>
                            <div class="info-item full-width">
                                <label>Mô tả chi tiết</label>
                                <div class="description-content">
                                    {{ violationDetail()!.moTa }}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Time Information Card -->
                <div class="detail-card">
                    <div class="card-header">
                        <div class="card-title">
                            <i class="fas fa-clock"></i>
                            <h3>Thời gian vi phạm</h3>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="time-info">
                            <div class="time-item">
                                <div class="time-icon">
                                    <i class="fas fa-exclamation-triangle"></i>
                                </div>
                                <div class="time-content">
                                    <label>Thời gian vi phạm</label>
                                    <span class="time-value">{{ formatDate(violationDetail()!.thoiGianViPham) }}</span>
                                </div>
                            </div>
                            <div class="time-item">
                                <div class="time-icon">
                                    <i class="fas fa-file-plus"></i>
                                </div>
                                <div class="time-content">
                                    <label>Ngày lập biên bản</label>
                                    <span class="time-value">{{ formatDate(violationDetail()!.ngayLap) }}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Room and Booking Information Card -->
                <div class="detail-card">
                    <div class="card-header">
                        <div class="card-title">
                            <i class="fas fa-door-open"></i>
                            <h3>Thông tin phòng & đặt phòng</h3>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="info-grid">
                            <div class="info-item">
                                <label>Phòng vi phạm</label>
                                <span class="value">{{ violationDetail()!.tenPhong }}</span>
                            </div>
                            <div class="info-item">
                                <label>Mã đặt phòng</label>
                                <span class="value">#{{ violationDetail()!.maDangKy }}</span>
                            </div>
                        </div>
                        <div class="booking-action">
                            <button class="btn-booking" (click)="goToBookingDetail(violationDetail()!.maDangKy)">
                                <i class="fas fa-eye"></i>
                                Xem chi tiết đặt phòng
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Processing Information Card -->
                <div class="detail-card">
                    <div class="card-header">
                        <div class="card-title">
                            <i class="fas fa-user-tie"></i>
                            <h3>Thông tin xử lý</h3>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="info-grid">
                            <div class="info-item">
                                <label>Người lập biên bản</label>
                                <span class="value">{{ violationDetail()!.nguoiLapBienBan || 'Chưa có thông tin'
                                    }}</span>
                            </div>
                            <div class="info-item">
                                <label>Trạng thái xử lý</label>
                                <span class="status-value"
                                    [style.color]="getStatusColor(violationDetail()!.trangThaiXuLy)">
                                    <i class="fas" [ngClass]="getStatusIcon(violationDetail()!.trangThaiXuLy)"></i>
                                    {{ violationDetail()!.trangThaiXuLy }}
                                </span>
                            </div>
                        </div>

                        @if (violationDetail()!.ghiChu) {
                        <div class="note-section">
                            <label>Ghi chú xử lý</label>
                            <div class="note-content">
                                {{ violationDetail()!.ghiChu }}
                            </div>
                        </div>
                        } @else {
                        <div class="note-section">
                            <div class="no-note">
                                <i class="fas fa-info-circle"></i>
                                <span>Chưa có ghi chú xử lý</span>
                            </div>
                        </div>
                        }
                    </div>
                </div>

                <!-- Status Timeline (if needed for future expansion) -->
                <div class="detail-card timeline-card">
                    <div class="card-header">
                        <div class="card-title">
                            <i class="fas fa-timeline"></i>
                            <h3>Trạng thái hiện tại</h3>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="status-timeline">
                            <div class="timeline-item active">
                                <div class="timeline-icon">
                                    <i class="fas fa-exclamation-triangle"></i>
                                </div>
                                <div class="timeline-content">
                                    <h4>Vi phạm được ghi nhận</h4>
                                    <p>{{ formatDate(violationDetail()!.thoiGianViPham) }}</p>
                                </div>
                            </div>

                            <div class="timeline-item active">
                                <div class="timeline-icon">
                                    <i class="fas fa-file-plus"></i>
                                </div>
                                <div class="timeline-content">
                                    <h4>Biên bản được lập</h4>
                                    <p>{{ formatDate(violationDetail()!.ngayLap) }}</p>
                                </div>
                            </div>

                            <div class="timeline-item"
                                [class.active]="violationDetail()!.trangThaiXuLy !== 'Chưa xử lý'"
                                [class.current]="violationDetail()!.trangThaiXuLy === 'Đang xử lý'">
                                <div class="timeline-icon">
                                    <i class="fas" [ngClass]="getStatusIcon(violationDetail()!.trangThaiXuLy)"></i>
                                </div>
                                <div class="timeline-content">
                                    <h4>{{ violationDetail()!.trangThaiXuLy }}</h4>
                                    <p>Trạng thái hiện tại</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="action-section">
                <div class="action-buttons">
                    <button class="action-btn secondary" (click)="goBack()">
                        <i class="fas fa-list"></i>
                        <span>Về danh sách</span>
                    </button>
                    <button class="action-btn primary" (click)="goToBookingDetail(violationDetail()!.maDangKy)">
                        <i class="fas fa-eye"></i>
                        <span>Xem đặt phòng</span>
                    </button>
                </div>
            </div>
        </div>
    </div>
    }

    <!-- Loading State -->
    @if (loading()) {
    <div class="loading-state">
        <div class="container">
            <div class="loading-content">
                <div class="spinner large"></div>
                <h3>Đang tải chi tiết vi phạm...</h3>
                <p>Vui lòng đợi trong giây lát</p>
            </div>
        </div>
    </div>
    }

    <!-- Error State -->
    @if (error()) {
    <div class="error-state">
        <div class="container">
            <div class="error-content">
                <div class="error-icon">
                    <i class="fas fa-exclamation-triangle"></i>
                </div>
                <h3>Không thể tải chi tiết</h3>
                <p>{{ error() }}</p>
                <div class="error-actions">
                    <button class="action-btn secondary" (click)="refresh()">
                        <i class="fas fa-refresh"></i>
                        <span>Thử lại</span>
                    </button>
                    <button class="action-btn primary" (click)="goBack()">
                        <i class="fas fa-arrow-left"></i>
                        <span>Quay lại</span>
                    </button>
                </div>
            </div>
        </div>
    </div>
    }
</div>