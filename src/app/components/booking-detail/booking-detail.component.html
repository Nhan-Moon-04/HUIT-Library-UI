<!-- Modern Booking Detail Page -->
<div class="modern-booking-detail">
    <!-- Header Section -->
    <div class="detail-header">
        <div class="container">
            <div class="header-content">
                <div class="breadcrumb">
                    <button class="back-btn" (click)="router.navigate(['/booking/history'])">
                        <i class="fas fa-arrow-left"></i>
                        <span>Lịch sử mượn phòng</span>
                    </button>
                    <i class="fas fa-chevron-right separator"></i>
                    <span class="current-page">Chi tiết đặt phòng</span>
                </div>

                @if (!loading() && bookingDetail()) {
                <div class="header-info">
                    <div class="booking-title">
                        <h1>{{ bookingDetail()!.tenPhong }}</h1>
                        <span class="booking-id">#{{ bookingDetail()!.maDangKy }}</span>
                    </div>
                    <div class="status-section">
                        <div class="status-badge" [ngClass]="getStatusClass(bookingDetail()!.maTrangThai)">
                            <i class="fas" [ngClass]="getStatusIcon(bookingDetail()!.maTrangThai)"></i>
                            <span>{{ bookingDetail()!.tenTrangThai }}</span>
                        </div>
                        @if (hasViolations()) {
                        <div class="violation-indicator">
                            <i class="fas fa-exclamation-triangle"></i>
                            <span>{{ violations().length }} vi phạm</span>
                        </div>
                        }
                    </div>
                </div>
                }
            </div>
        </div>
    </div>

    <!-- Main Content -->
    @if (!loading() && bookingDetail()) {
    <div class="detail-content">
        <div class="container">
            <div class="content-grid">
                <!-- Room Information Card -->
                <div class="detail-card">
                    <div class="card-header">
                        <div class="card-title">
                            <i class="fas fa-door-open"></i>
                            <h3>Thông tin phòng</h3>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="info-grid">
                            <div class="info-item">
                                <label>Tên phòng</label>
                                <span class="value primary">{{ bookingDetail()!.tenPhong }}</span>
                            </div>
                            <div class="info-item">
                                <label>Loại phòng</label>
                                <span class="value">{{ bookingDetail()!.tenLoaiPhong }}</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Schedule Information Card -->
                <div class="detail-card">
                    <div class="card-header">
                        <div class="card-title">
                            <i class="fas fa-calendar-alt"></i>
                            <h3>Thời gian sử dụng</h3>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="time-schedule">
                            <div class="time-block start">
                                <div class="time-icon">
                                    <i class="fas fa-play"></i>
                                </div>
                                <div class="time-info">
                                    <label>Bắt đầu</label>
                                    <span class="time-value">{{ formatDateTime(bookingDetail()!.thoiGianBatDau)
                                        }}</span>
                                </div>
                            </div>
                            <div class="time-separator">
                                <i class="fas fa-long-arrow-alt-right"></i>
                            </div>
                            <div class="time-block end">
                                <div class="time-icon">
                                    <i class="fas fa-stop"></i>
                                </div>
                                <div class="time-info">
                                    <label>Kết thúc</label>
                                    <span class="time-value">{{ formatDateTime(bookingDetail()!.thoiGianKetThuc)
                                        }}</span>
                                </div>
                            </div>
                        </div>

                        @if (bookingDetail()!.gioBatDauThucTe || bookingDetail()!.gioKetThucThucTe) {
                        <div class="actual-time">
                            <h4>Thời gian thực tế</h4>
                            <div class="actual-info">
                                @if (bookingDetail()!.gioBatDauThucTe) {
                                <div class="actual-item">
                                    <i class="fas fa-clock"></i>
                                    <span>Bắt đầu: {{ formatDateTime(bookingDetail()!.gioBatDauThucTe!) }}</span>
                                </div>
                                }
                                @if (bookingDetail()!.gioKetThucThucTe) {
                                <div class="actual-item">
                                    <i class="fas fa-clock"></i>
                                    <span>Kết thúc: {{ formatDateTime(bookingDetail()!.gioKetThucThucTe!) }}</span>
                                </div>
                                }
                            </div>
                        </div>
                        }
                    </div>
                </div>

                <!-- Booking Details Card -->
                <div class="detail-card">
                    <div class="card-header">
                        <div class="card-title">
                            <i class="fas fa-clipboard-list"></i>
                            <h3>Chi tiết đặt phòng</h3>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="info-grid">
                            @if (bookingDetail()!.lyDo) {
                            <div class="info-item">
                                <label>Mục đích</label>
                                <span class="value">{{ bookingDetail()!.lyDo }}</span>
                            </div>
                            }
                            @if (bookingDetail()!.soLuong) {
                            <div class="info-item">
                                <label>Số lượng người</label>
                                <span class="value">{{ bookingDetail()!.soLuong }} người</span>
                            </div>
                            }
                            @if (bookingDetail()!.ngayDuyet) {
                            <div class="info-item">
                                <label>Ngày duyệt</label>
                                <span class="value">{{ formatDateTime(bookingDetail()!.ngayDuyet!) }}</span>
                            </div>
                            }
                            <div class="info-item">
                                <label>Ngày tạo</label>
                                <span class="value">{{ formatDate(bookingDetail()!.ngayMuon) }}</span>
                            </div>
                        </div>

                        @if (bookingDetail()!.ghiChu) {
                        <div class="note-section">
                            <label>Ghi chú</label>
                            <p class="note-content">{{ bookingDetail()!.ghiChu }}</p>
                        </div>
                        }
                    </div>
                </div>

                <!-- Room Condition Card -->
                @if (bookingDetail()!.tinhTrangPhong || bookingDetail()!.ghiChuSuDung) {
                <div class="detail-card">
                    <div class="card-header">
                        <div class="card-title">
                            <i class="fas fa-clipboard-check"></i>
                            <h3>Tình trạng phòng</h3>
                        </div>
                    </div>
                    <div class="card-body">
                        @if (bookingDetail()!.tinhTrangPhong) {
                        <div class="room-status">
                            <label>Tình trạng</label>
                            <span class="status-value" [class]="getRoomStatusClass(bookingDetail()!.tinhTrangPhong!)">{{
                                bookingDetail()!.tinhTrangPhong }}</span>
                        </div>
                        }
                        @if (bookingDetail()!.ghiChuSuDung) {
                        <div class="usage-note">
                            <label>Ghi chú sử dụng</label>
                            <p class="note-content">{{ bookingDetail()!.ghiChuSuDung }}</p>
                        </div>
                        }
                    </div>
                </div>
                }

                <!-- Violations Card -->
                @if (violations().length > 0) {
                <div class="detail-card violation-card">
                    <div class="card-header">
                        <div class="card-title">
                            <i class="fas fa-exclamation-triangle"></i>
                            <h3>Biên bản vi phạm ({{ violations().length }})</h3>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="violation-list">
                            @for (violation of violations(); track violation.maViPham) {
                            <div class="violation-item" (click)="viewViolationDetail(violation.maViPham)">
                                <div class="violation-icon" [class]="getViolationStatusClass(violation.trangThaiXuLy)">
                                    <i class="fas" [ngClass]="getViolationStatusIcon(violation.trangThaiXuLy)"></i>
                                </div>
                                <div class="violation-content">
                                    <h5>{{ violation.tenViPham }}</h5>
                                    @if (violation.moTaNgan) {
                                    <p class="violation-description">{{ violation.moTaNgan }}</p>
                                    }
                                    <div class="violation-meta">
                                        <span class="violation-date">
                                            <i class="fas fa-calendar"></i>
                                            {{ formatViolationDate(violation.ngayLap) }}
                                        </span>
                                        <span class="violation-status"
                                            [class]="getViolationStatusClass(violation.trangThaiXuLy)">
                                            {{ violation.trangThaiXuLy }}
                                        </span>
                                    </div>
                                </div>
                                <div class="violation-action">
                                    <i class="fas fa-chevron-right"></i>
                                </div>
                            </div>
                            }
                        </div>

                        @if (loadingViolations()) {
                        <div class="loading-violations">
                            <div class="spinner"></div>
                            <span>Đang tải biên bản...</span>
                        </div>
                        }
                    </div>
                </div>
                }
            </div>

            <!-- Action Buttons -->
            @if (canShowActions()) {
            <div class="action-section">
                <div class="action-buttons">
                    <button class="action-btn secondary" (click)="router.navigate(['/booking/history'])">
                        <i class="fas fa-list"></i>
                        <span>Về danh sách</span>
                    </button>
                    @if (canExtend()) {
                    <button class="action-btn primary">
                        <i class="fas fa-clock"></i>
                        <span>Gia hạn</span>
                    </button>
                    }
                    @if (canCancel()) {
                    <button class="action-btn danger">
                        <i class="fas fa-times"></i>
                        <span>Hủy đặt phòng</span>
                    </button>
                    }
                </div>
            </div>
            }
        </div>
    </div>
    }

    <!-- Loading State -->
    @if (loading()) {
    <div class="loading-state">
        <div class="container">
            <div class="loading-content">
                <div class="spinner large"></div>
                <h3>Đang tải chi tiết đặt phòng...</h3>
                <p>Vui lòng đợi trong giây lát</p>
            </div>
        </div>
    </div>
    }

    <!-- Error State -->
    @if (error()) {
    <div class="error-state">
        <div class="container">
            <div class="error-content">
                <div class="error-icon">
                    <i class="fas fa-exclamation-triangle"></i>
                </div>
                <h3>Không thể tải chi tiết</h3>
                <p>{{ error() }}</p>
                <div class="error-actions">
                    <button class="action-btn secondary" (click)="loadBookingDetail()">
                        <i class="fas fa-refresh"></i>
                        <span>Thử lại</span>
                    </button>
                    <button class="action-btn primary" (click)="router.navigate(['/booking/history'])">
                        <i class="fas fa-arrow-left"></i>
                        <span>Quay lại</span>
                    </button>
                </div>
            </div>
        </div>
    </div>
    }
</div>